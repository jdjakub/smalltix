# drawOn: aCanvas
# 	| topAndBottom |
# 	topAndBottom := Array with: (self bounds) with: (Rectangle origin: 0@0 corner: 100@100).
# 	topAndBottom do: [:each | aCanvas fillRectangle: each color: self color].
self=$1
aCanvas=$2
tmp1=$(./send $self bounds)
tmp2=$(./send int/0 @ int/0)
tmp3=$(./send int/100 @ int/100)
tmp4=$(./send Rectangle origin-corner- $tmp2 $tmp3)
topAndBottom=$(./send Array with-with- $tmp1 $tmp4)
# Above is within st2bash capabilities.
# Hand-compile the BlockClosure stuff. TODO: automate
# topAndBottom do: [:each | aCanvas fillRectangle: each color: self color].
#
# -->
#
# 1. Extract block body into new file drawOn-~block1
# _method: topAndBottom and: aCanvas and: each
#   aCanvas fillRectangle: each color: self color
#
# The general pattern is
# _method: (outer temps) and: (outer args) and (inner temps) and: (inner args)
# Here, there is 1 outer temp: topAndBottom;
#       there is 1 outer arg: aCanvas;
#       there are 0 inner temps;
#       there is 1 inner arg: each
#
# 2. Compile it
# 3. Split the send into a block creation send followed by usage send:
# block1 := BlockClosure fromCode: SBECrossMorph/methods/drawOn-~block1
#                        with: #(self topAndBottom aCanvas).
# topAndBottom do: block1
bindings=$(./send Array with-with-with- $self $topAndBottom $aCanvas)
block1=$(./send BlockClosure fromCode-with- SBECrossMorph/methods/drawOn-~block1 $bindings)
./send $topAndBottom do- $block1
# This will create:
# someBindings/ = Array #($self $topAndBottom $aCanvas)
# aBlockClosure/
# |- class = BlockClosure
# |- _code = SBECrossMorph/methods/drawOn-~block1
# |- bindings = someBindings